![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_01.png)

* `0x100`
* `0xAB`
* `0x13`
* `0xAB`
* `0x11`
* `0x13`
* `0xFF`
* `0x11`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_02.png)

* `l`
* `w`
* `b`
* `b`
* `q`
* `w`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_03.png)

* x86-64 æ¶æ„å¯»å€å¿…é¡»ç”¨ 64 ä½åœ°å€ï¼Œå› æ­¤ä¸èƒ½ç”¨ 32 ä½å¯„å­˜å™¨ä½œä¸ºåœ°å€è®¿é—®å†…å­˜ã€‚
* æŒ‡ä»¤æŒ‡å®šè¦æ“ä½œçš„æ˜¯åŒå­—ï¼Œä½†å¯„å­˜å™¨ç”¨äº† 64 ä½çš„ã€‚
* ä¸èƒ½ç›´æ¥ç§»åŠ¨å†…å­˜åˆ°å†…å­˜ï¼Œè¦ç”¨å¯„å­˜å™¨ä½œä¸ºä¸­é—´æš‚å­˜ã€‚
* æ²¡æœ‰ slï¼Œè€Œæ˜¯ sil
* ç«‹å³æ•°ä¸èƒ½ä½œä¸ºç›®çš„
* æ“ä½œçš„æºå¯„å­˜å™¨å’Œç›®çš„å¯„å­˜å™¨ç±»å‹ä¸åŒ¹é…
* si å•ä½æ˜¯å­—

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_04.png)

* `char int`
	* `movsbl (%rdi), %eax`
	* `movl %eax, (%rsi)`

* `char unsigned`
	* `movzbl (%rdi), %eax`
	* `movl %eax, (%rsi)`

* `unsigned char, long`
	* `movzbq (%rdi), %rax`
	* `movq %rax, (%rsi)`

* `int char`
	* `movl (%rdi), %eax`
	* `movb %al, (%rsi)`

* `unsigned unsigned char`
	* `movl (%rdi), %eax`
	* `movb %al, (%rsi)`

* `char short`
	* `movsbw (%rdi), %ax`
	* `movs %al, (%rsi)`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_05.png)

~~~C
*yp = *xp;
*zp = *yp;
*xp = *zp;
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_06.png)

* `6 + x`
* `x + y`
* `x + 4y`
* `9x + 7`
* `4y + A`
* `x + 2y + 9`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_07.png)

`5x + 2y + 8z`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_08.png)

* `0x100` `0x100`
* `0x108` `0xA8`
* `0x118` `0x110`
* `0x110` `0x14`
* `%rcx` `0`
* `%rax` `0xFD`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_09.png)

* `salq $4, %rax`
* `sarq %cl, %rax`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_10.png)

* `z - ~((x | y) >> 3)`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_11.png)

* A. å°† %rdx æ¸…é›¶
* B. `movl $0, %rdx`
* C. `xorl %edx, %edx` 2 å­—èŠ‚ï¼Œ`movl $0, %edx` 5 å­—èŠ‚

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_12.png)

~~~C
mov %rdx, %r8
movq %rdi, %rax
cqto
divq %rsi
movq %rax, (%r8)
movq %rdx, (%rcx)
ret
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_13.png)

* A. `int <`
* B. `short >=`
* C. `unsigned char <=`
* D. `long, unsigned long, pointer !=`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_14.png)

* A. `long >=`
* B. `short unsigned short ==`
* C. `unsigned char >`
* D. `int unsigned int !=`  è¿™é‡Œä¹¦ä¸Šçš„ç­”æ¡ˆåªæœ‰ int, ä½†ç»è¿‡æµ‹è¯•ï¼Œç¼–è¯‘å™¨çš„ç¡®ä¼šå¯¹ `data_t` ä¸º unsigned int çš„ä»£ç ç”ŸæˆåŒæ ·çš„æ±‡ç¼–ã€‚ä½¿ç”¨çš„ä¼˜åŒ–ç­‰çº§ä¸º `-O1`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_15.png)

* A. `4003fe`
* B. `400425`
* C. `400543` `400545`
* D. `400560`

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_16.png)

* A.
~~~C
if (p == 0)
	goto done;
if (*p >= a)
	goto done;
*p = a;
done:
return;
~~~

* B. å› ä¸ºåœ¨ä¸€ä¸ª if è¯­å¥ä¸­åˆ¤æ–­äº†ä¸¤ä¸ªæ¡ä»¶

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_17.png)

* A.
~~~C
if (x < y)
	goto ok;
ge_cnt++;
result = x - y;
return result;
ok:
	lt_cnt++;
	result = y - x;
return result;
~~~

* B. å¦‚æœæ¡ä»¶åˆ¤æ–­æ²¡æœ‰ else åˆ†æ”¯çš„è¯ï¼Œç»§ç»­é‡‡ç”¨ç¬¬äºŒç§ç¿»è¯‘è§„åˆ™ä¼šå˜æˆè¿™æ ·

~~~C
if (condition)
	goto fit_condition;
empty statement
return;
fit_condition:
	things really do
return;
~~~

å¦‚æœé‡‡ç”¨ç¬¬ä¸€ç§è§„åˆ™ä¼šå˜æˆ

~~~C
if (!condition)
	goto done;
	things really do
done:
return;	
~~~

å¯ä»¥çœ‹å‡ºï¼Œä¸‹é¢è¿™ç§ä»£ç æ›´å‹å¥½ä¸€äº›ï¼Œä»£ç ä½“ç§¯æ›´å°ï¼Œæ¡ä»¶æ»¡è¶³å¯ä»¥å’Œæ¡ä»¶ä¸æ»¡è¶³å…±ç”¨ä¸€ä¸ªç»“æŸæµç¨‹ã€‚ 

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_18.png)

* ç”±é¢˜ç›®ç»™å‡ºçš„éƒ¨åˆ†ä»£ç æ¨æ–­ï¼Œåœ¨ç¬¬ä¸€ä¸ªåˆ¤æ–­æ»¡è¶³åçš„è·³è½¬ä¸­ï¼Œä¼šå†æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œå› æ­¤ï¼Œå‡å¦‚æŠŠ `x >= -3` å½“ä½œç¬¬ä¸€ä¸ª if çš„åˆ¤æ–­è¯­å¥ï¼Œé‚£ä¹ˆè·³è½¬åˆ° `.L2` åï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè‹¥  `x <= 2` ç¨‹åºç›´æ¥é€€å‡ºï¼Œä¸ä¼šå†æœ‰ç¬¬äºŒä¸ª `val` çš„èµ‹å€¼ï¼Œå› æ­¤ç¬¬ä¸€ä¸ª if è¯­å¥çš„æ¡ä»¶ä¸€å®šæ˜¯ `x < -3`

~~~C
long test(long x, long y, long z) {
	long val = x + y + z;
	if (x < -3) {
		if (y >= z)
			val = y * z;
		else
			val = x * y;
	} else if (x > 2)
		val = x * z;
	return val;
}
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_19.png)

* A. `Tavg(p) = Tok + pTmp`
* ç”±å…¬å¼å¯ä»¥çŸ¥é“ï¼Œå‡å¦‚æ¨¡å¼æ˜¯éšæœºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ `Tok + 0.5Tmp = 31`ï¼Œå‡å¦‚æ˜¯éå¸¸å¯é¢„æµ‹çš„ï¼Œé‚£ä¹ˆ `Tok = 16`ï¼Œå› æ­¤ `Tmp = 15/0.5 = 30`
* B. å½“åˆ†æ”¯é¢„æµ‹é”™è¯¯æ—¶ï¼Œè¿™ä¸ªå‡½æ•°éœ€è¦ `30 + 16 = 36` ä¸ªæ—¶é’Ÿå‘¨æœŸ

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_20.png)

* A. OP è¿›è¡Œçš„æ“ä½œæ˜¯é™¤æ³•
* B.

~~~C
arith:
	leaq 7(%rdi), %rax		; å‡è®¾ x æ˜¯è´Ÿæ•°ï¼Œé‚£ä¹ˆå¯¹é½ä½ç§»æ›¿ä»£é™¤æ³•éœ€è¦åšåŠ ä¸Šåç½®é‡ 7
	testq %rdi, %rdi			; if x < 0 ?
	cmovns %rdi, %rax		; if x < 0  t = x + 7
	sarq $3, %rax				; t >>= 3ï¼Œå°† t ä½œä¸ºè¿”å›å€¼
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_21.png)

~~~C
long test(long x, long y) {
	long val = 8 * x;
	if (y > 0) {
		if (x > y)
			val = x & y;
		else
			val = y - x;	
	} else if (y <= -2)
		val = x + y;
	return val;
}
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_22.png)

* A. ç”±ä¸Šè¿°ç¨‹åºå¯ä»¥ç®—å‡ºï¼Œç”¨ 32 ä½ int è¡¨ç¤º n!ï¼Œæœ€å¤§çš„ n æ˜¯ 12
* B. ç”¨ 64 ä½ long è¡¨ç¤ºï¼Œæœ€å¤§çš„ n æ˜¯ 20

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_23.png)

* A. `%rcx` ç”¨æ¥æ”¾ y, `%rax` ç”¨æ¥æ”¾ x, `%rdx` ç”¨æ¥æ”¾ n
* B. å› ä¸º x çš„å€¼å–å‡ºæ¥å°±æ˜¯ç¾è½®ç¾å¥‚å¾ªç¯åŠ ä¸ª 1ï¼Œé‚£ä¸å¦‚å’Œ `x += y` åˆå¹¶ä¸€ä¸‹ï¼Œå˜æˆ `x += (y + 1)` å°±å¥½å’¯
* C. 

~~~C
dw_loop:
	movq %rdi, %rax				; t = x
	movq %rdi, %rcx
	imulq %rdi, %rcx				; x^2
	leaq (%rdi, %rdi), %rdx		; i = 2x
.L2:
	leaq 1(%rcx, %rax), %rax	; t = t + x^2 + 1
	subq $1, %rdx					; i--
	testq %rdx, %rdx				; if i > 0 goto L2
	jg .L2
	rep
	ret
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_24.png)

~~~C
long loop_while(long a, long b)
{
	long result = 1;
	while (a < b) {
		result *= (a + b);
		a++;
	}
	return result;
}
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_25.png)

~~~C
long result = b;
while (b > 0) {
	result *= a;
	b -= a;
}
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_26.png)

* A. `jmp-to-middle`
* B. 

~~~C
long fun_a(unsigned long x) {
	long val = 0;
	while (x != 0) {
		val ^= x;
		x >>= 1;
	}
	return val & 1;
}
~~~

* C. ç¡®å®šæ˜¯å¥‡æ•°ä¸ª 1 è¿˜æ˜¯å¶æ•°ä¸ª 1

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_27.png)

~~~C
long fact_for(long n)
{
	long i = 2;;
	long result = 1;
	while (i <= n) {
		result *= i;
		i++;
	}
}

	push %rbp
	movq %rsp, %rbp
	movl $1, %eax
	movl $2, %ecx
	cmp %rdi, %rcx
	jg done
fact_for_loop:
	imulq %rcx, %rax
	addq %rcx
	cmp %rdi, %rcx
	jle fact_for_loop
done:
	mov %rbp, %rsp
	pop %rbp
	rep
	ret
	
long fact_for_goto(long n)
{
	long result = 1;
	long i = 2;
	if (i > n)
		goto done;
		
fact_for_loop:
	result *= i;
	i++;
	if (i <= n) 
		goto fact_for_loop;
	return result;
}
	
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_28.png)

* A.
~~~C
long fun_b(unsigned long x)
{
	long val = 0;
	long i;
	for (i = 64; i != 1; i--) {
		val <<= 1;
		val |= (x & 1);
		x >>= 1;
	}
	return val;
}
~~~

* B. è¿™ä¸ªæµ‹è¯•æ˜¯é€šè¿‡ sub å‘½ä»¤æ‰€è®¾ç½®çš„æ ‡å¿—å¯„å­˜å™¨æ¥åšçš„ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–æµ‹è¯•
* C. è¿™ä¸ªå‡½æ•°å°† x çš„äºŒè¿›åˆ¶ä½æ¨¡å¼åè½¬

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_29.png)

~~~C
æ‰‹å†™çš„æ±‡ç¼–...

	movl $0, %eax
	movl $0, %ecx
	cmpq $10, %rcx
	jge done

do_things_loop:
	movl %ecx, %edx
	andq $1, %rdx
	jz not_do_anything
	addq %rcx, %rax 
not_do_anything:
	addl $1, %ecx
	cmpq $10, %rcx
	jl do_things_loop

done:
	rep
	ret
	
æ‰‹å†™çš„ goto å‡½æ•°...

	long sum = 0;
	long i = 0;
	if (i > 10)
		goto done;
	
do_things_loop:
	if (i & 1 == 0)
		goto do_nothing;
		
	sum += i;
	
do_nothing:
	i++;
	goto do_things_loop;
	
done:
	return sum;
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_30.png)

* A. æœ€å°æ ‡å·æ˜¯ -1ï¼Œæ ‡å·åˆ†åˆ«ä¸º -1, 0, 1, 2, 4, 5, 7
* B. æ ‡å· 2 å’Œæ ‡å· 4 å…±ç”¨ï¼Œ0 å’Œ  7 å…±ç”¨


![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_31.png)

~~~C
void switcher(long a, long b, long c, long *dest)
{
	long val;
	switch(a) {
		case 0:
			val = c + 112;
			break;
		case 2:
		case 7:
			val = (b + c) << 2;
			break;
		case 4:
			val = a;
			break;
		case 5:
			val = b ^ 5;
			break;
		default:
			val = b;
	}
	return val;
}
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_32.png)

||||||||||
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|æ ‡å·|PC| æŒ‡ä»¤|%rdi|%rsi|%rax|%rsp|*%rsp|æè¿°|
|M1|0x400560|callq|10|-|-|0x7fffffffe820|-|è°ƒç”¨ first(10)|
|F1|0x400548|lea|10|11|-|0x7fffffffe818|0x400565|-|
|F2|0x40054c|sub| 9|11|-|0x7fffffffe818|0x400565|-|
|F3|0x400550|callq|9|11|-|0x7fffffffe818|0x400565|-|
|L1|0x400540|mov|9|11|9|0x7fffffffe810|0x400555|-|
|L2|0x400543|imul|9|11|99|0x7fffffffe810|0x400555|-|
|L3|0x400547|retq|9|11|99|0x7fffffffe810|0x400555|-|
|F4|0x400555|repz|9|11|99|0x7fffffffe818|0x400565|-|
|M2|0x400565|mov|9|11|99|0x7fffffffe810|-|-|

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_33.png)

* ä» `movl $6, %eax` çŒœæµ‹ï¼Œä¸€å®šæ˜¯ä¸€ä¸ª int å’Œä¸€ä¸ª short, æ ¹æ® `movslq %edi, %rdi` éªŒè¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ int, ç¬¬äºŒä¸ªæ˜¯ shortã€‚
* ä» 3, 4 å¥å¾—çŸ¥ï¼Œç¬¬ 3, 4 ä¸ªå‚æ•°éƒ½æ˜¯æŒ‡é’ˆï¼Œå¹¶ä¸” addqï¼Œè¯´æ˜ç¬¬ 3 ä¸ªæ˜¯ `long *`ï¼Œaddbï¼Œè¯´æ˜ç¬¬ 4 ä¸ªæ˜¯ `char *`ã€‚

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_34.png)

* A. `x + 1`, `x + 2`, `x + 3`, `x + 4`, `x + 5` åœ¨å¯„å­˜å™¨é‡Œã€‚
* B. `x + 6`, `x + 7` åœ¨æ ˆé‡Œ
* C. å› ä¸ºè¢«è°ƒç”¨è€…ä¿å­˜çš„å¯„å­˜å™¨ç”¨å…‰äº† 

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_35.png)

* A. %rbx çš„å€¼æ˜¯å³ç§»ä¹‹å‰çš„ x

~~~C
long rfun(unsigned long x) 
{
	if (x == 0)
		return 0;
	unsigned long nx = (x >> 2);
	long rv = rfun(nx);
	return x + rv;
}
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_36.png)

||||||
|:---:|:---:|:---:|:---:|:---:|
|æ•°ç»„|å…ƒç´ å¤§å°|æ•´ä¸ªæ•°ç»„çš„å¤§å°|èµ·å§‹åœ°å€|å…ƒç´  i|
|S|2|14|xs|xs + 2i|
|T|8|24|xt|XT + 8i|
|U|8|48|xu|xu + 8i|
|V|4|32|xv|xv + 4i|
|W|8|32|xw|xw + 8i|

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_37.png)

|è¡¨è¾¾å¼|ç±»å‹|å€¼|æ±‡ç¼–ä»£ç |
|:--:|:--:|:--:|:--:|
|s + 1|short *|xs + 2|leaq 1(%rdx), %rax|
|s[3]|short|M[xs + 6]|movw 6(%rdx), %ax|
|&s[i]|short *|xs + 2i|leaq (%rdx, %rcx, 2), %rax|
|s[4*i + 1]|short|M[xs + 8i + 2]|movw 2(%rdx, %rcx, 8), %ax|
|s + i - 5|short *|xs + 2i - 10| leaq -5(%rdx, %rcx), %rax|

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_38.png)

* M = 5, N = 7


![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_39.png)

* ä»æ±‡ç¼–ä»£ç å¯ä»¥çœ‹å‡º, &A[i][0] å°±æ˜¯ A + 64i = A + 4(16 * i + 0) å³ A[i][0]
* ä¹Ÿå¯ä»¥çœ‹å‡º &B[0][k] å°±æ˜¯ B + 4k = B + 4(16 * 0 + k) å³ B[0][k]
* ä¹Ÿå¯ä»¥çœ‹å‡º &B[N][K] å°±æ˜¯ B + 1024k = B + 4(16 * 16 + k)ï¼Œå³  B[16][k]

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_40.png)

~~~C
void fix_set_diag_opt(fix_matrix A, int val) {
	int *cur = &A[0][0];
	long i = 0;
	long iend = N*(N + 1);
	do {
		cur[i] = val;
		i += (N + 1);
	} while (i != iend);
}
~~~ 

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_41.png)

* A. 0, 8, 12, 16
* B. 24
* C.

~~~C
void sp_init(struct prob *sp) {
	sp->s.x = sp->s.y;
	sp->p = &sp->s.x;
	sp->next = sp;
}
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_42.png)

* A.

~~~C
long fun(struct ELE *ptr) {
	long result = 0;
	while (ptr != NULL) 
		result += ptr->v;
	return result;
}
~~~

* B. é“¾è¡¨æ‰€æœ‰èŠ‚ç‚¹æ±‚å’Œ

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_43.png)

|expr|type|code|
|:--:|:--:|:--:|
|up->t1.u|long| `movq (%rdi), %rax`, `movq %rax, (%rsi)`|
|up->t1.v|short|`movw 8(%rdi), %ax`, `movw %ax, (%rsi)`|
|&up->t1.w|char *|`leaq 10(%rdi), %rax`, `movq %rax, (%rsi)`|
|up->t2.a|int *|`movq %rdi, %(rsi)`|
|up->t2.a[up->t1.u]|int|`movq (%rdi), %rax`, `movl (%rdi, %rax, 4), %eax`, `movl %eax, (%rsi)`|
|*up->t2.p|char|`movb 8(%rdi), %al`, `movb %al, (%rsi)`|

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_44.png)

* A. 0, 4, 8, 12, å¡«å…… 3 å­—èŠ‚ï¼Œæ€»å…±æ˜¯ 16 å­—èŠ‚, ä»¥ 4 å­—èŠ‚å¯¹é½
* B. 0. 4, 5, 8, æ— å¡«å……å­—èŠ‚ï¼Œæ€»å…±æ˜¯  16 å­—èŠ‚ï¼Œä»¥ 8 å­—èŠ‚å¯¹é½
* C. 0, 6, å¡«å…… 1 å­—èŠ‚ï¼Œæ€»å…±æ˜¯ 10 å­—èŠ‚ï¼Œä»¥ 2 å­—èŠ‚å¯¹é½ 
* D. 0, 16, æ— å¡«å……å­—èŠ‚ï¼Œæ€»å…±æ˜¯ 40 å­—èŠ‚ï¼Œä»¥ 8 å­—èŠ‚å¯¹é½
* E. 0, 24, æ— å¡«å……å­—èŠ‚ï¼Œæ€»å…±æ˜¯ 40 å­—èŠ‚ï¼Œä»¥ 8 å­—èŠ‚å¯¹é½

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_45.png)

* A. 0, 8, 16, 24, 28, 32, 40, 48, å¡«å…… 4 ä¸ªå­—èŠ‚ï¼Œä»¥ä½¿ç»“æ„æ•°ç»„ä¸­ä¸‹ä¸€ä¸ª struct rec çš„ç¬¬ä¸€ä¸ªæˆå‘˜ char *a çš„åœ°å€æ˜¯ 8 çš„å€æ•°ã€‚
* B. æ€»å¤§å°æ˜¯ 52 + 4 ä¸ªå¡«å……å­—èŠ‚ = 56 å­—èŠ‚
* C. æ€æƒ³æ˜¯å…ˆæŠŠå¤§çš„æ‹å‡ºæ¥æŒ¤åœ¨ä¸€å †ï¼Œç„¶åå†æŠŠå°çš„æŒ‰åˆ°ç©ºéš™é‡Œé¢å»ã€‚

~~~C
struct {
	char *a;
	long g;
	double c;
	int h;
	float e;
	short b;
	char f;
	char d;
} rec;
~~~  

* C. å½“å‰çš„åç§»æ˜¯: 0, 8, 16, 24, 28, 30, 32, 33, å¡«å…… 6 ä¸ªå­—èŠ‚ï¼Œæ€»å¤§å°æ˜¯ 40 å­—èŠ‚ã€‚

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_46.png)

* A. ä»æ±‡ç¼–ä¸­å¯ä»¥çœ‹å‡ºï¼Œç¼–è¯‘å™¨ä¸ºæ ˆåˆ†é…äº† 16 ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œå¹¶ä¸”æ ˆé¡¶åœ°å€å°±æ˜¯ buf çš„åœ°å€ï¼Œå› æ­¤åœ¨è¯»å…¥äº†ç»™å®šå­—ç¬¦ä¸²åï¼Œæ ˆç©ºé—´å¦‚ä¸‹æ‰€ç¤ºï¼š

|00|00|00|00|00|40|00|34|   `<---- è¿”å›åœ°å€`
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|01|23|45|67|89|AB|CD|EF|	 `<--- %rbp`
|-|-|-|-|-|-|-|-| 
|-|-|-|-|-|-|-|-|   `<--- æ ˆé¡¶ï¼Œå³ buf åœ°å€`

* B. å¦‚ä¸Šæ‰€ç¤º

|00|00|00|00|00|40|00|34|   `<---- è¿”å›åœ°å€`
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|33|32|31|30|39|38|37|36|	 `<--- %rbp`
|35|34|33|32|31|30|39|38|
|37|36|35|34|33|32|31|30|   `<--- æ ˆé¡¶ï¼Œå³ buf åœ°å€`

* C. ç¨‹åºä¼šè¿”å›åˆ° 0x40034 çš„åœ°å€

* D. %rbp çš„å€¼è¢«ç ´åäº†

* E. malloc æ²¡æœ‰æ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸º NULLï¼›ä¸åº”è¯¥åœ¨è¿™ç§åŠŸèƒ½çš„å‡½æ•°å†…è¿”å›å †å†…å­˜åœ°å€ï¼Œå¥½çš„å®è·µæ˜¯è¿”å›é™æ€ç¼“å†²åŒºå†…å­˜åœ°å€ã€‚å¯¹ malloc çš„è°ƒç”¨åº”è¯¥ä½¿ç”¨ strlen(buf) + 1 ä½œä¸ºå¤§å°ã€‚

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_47.png)

* A. åœ°å€çš„èŒƒå›´æ˜¯ 0xffffd754 - 0xffffb754 = 2000 å­—èŠ‚
* B. æ²¡çœ‹æ‡‚ nop sled çš„å·¥ä½œåŸç†....

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_48.png)

* A. a) ç‰ˆæœ¬ä¸­ï¼Œbuf åœ¨æ ˆé¡¶ï¼Œv åœ¨ %rsp + 24 çš„ä½ç½®, b) ç‰ˆæœ¬ï¼Œbuf åœ¨ %rsp + 16 çš„ä½ç½®ï¼Œv åœ¨ %rsp + 8  çš„ä½ç½®ï¼Œé‡‘ä¸é›€å€¼åœ¨ %rsp + 40 çš„ä½ç½®ã€‚

* B. å› ä¸ºå°† v å®‰æ’åœ¨äº†æ¯” buf å°çš„ä½ç½®ä¸Šï¼Œæ‰€ä»¥ buf ç¼“å†²åŒºå³ä½¿æº¢å‡ºä¹Ÿä¸ä¼šä¿®æ”¹ v çš„å€¼ã€‚ 

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_49.png)

* A. å°† `8n + 22` å‘ä¸‹èˆå…¥åˆ°è·ç¦» `8n + 22`  æœ€è¿‘çš„ 16 çš„å€æ•°
* B. ç”¨å‘å³ä½ç§»æ¥ä»£æ›¿è¡¥ç é™¤æ³•ï¼Œæ‰€ä»¥å…ˆåŠ ä¸Šä¸€ä¸ªåç½®
* C. 

|n| s1| s2|p|e1|e2|
|:--:|:--:|:--:|:--:|:--:|:--:|
|5|2065|2017|1024|1|7|
|6|2064|2000|2000|16|0|

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_50.png)

* ä»ç¬¬ä¸€å¥çœ‹å‡º, *ip å–å‡ºæ¥æ”¾åˆ° %eax ä¸­ï¼Œç»å†äº†è¢«è½¬æˆ floatï¼Œç„¶åå†èµ‹å€¼ç»™ *fpï¼Œå› æ­¤ val2 æ˜¯ i
* ä»ç¬¬äºŒå¥ï¼Œ*fp å–å‡ºæ¥ä¹‹åæœ€åè½¬æˆ double ç„¶åè£…åœ¨ xmm0 ä¸­ä½œä¸ºè¿”å›å€¼ï¼Œå› æ­¤ val4 æ˜¯ f 
* ä»ç¬¬ä¸‰å¥, *dp å–å‡ºæ¥è¢«è½¬ä¸º int, ç„¶åèµ‹å€¼ç»™ *ipï¼Œå› æ­¤ val1 æ˜¯ d
* ä»ç¬¬ 8 å¥ï¼Œl å–å‡ºæ¥è½¬æˆ doubleï¼Œç„¶åèµ‹å€¼ç»™ *dpï¼Œå› æ­¤ val3 æ˜¯ l

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_51.png)

|Tx|Ty|æŒ‡ä»¤|
|:--:|:---:|:---:|
|long|double|`cvtsi2sdq %rdi, %xmm0`|
|double|int|`cvtsd2si %xmm0, %eax`|
|double|float|`cvtss2sd %xmm0, %xmm0`|
|long|float|`cvtss2si %xmm0, %rax`|
|float|long|`cvtsi2ssq %rdi, %xmm0`|

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_52.png)

* A. %xmm0 a, %rdi b, %xmm1 c, %esi d
* B. %edi a, %rsi b, %rdx c, %rcx d
* C. %rdi a, %xmm0 b, %esi c, %xmm1 d
* D. %xmm0 a, %rdi b, %xmm1 c, %xmm2 d

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_53.png)

* ä¸€å®šæœ‰ä¸¤ä¸ª int, long  æˆ–è€…æŒ‡é’ˆï¼Œå› ä¸ºå‚æ•°ç”¨åˆ°äº† %rsi
* %rsi ä¸­æ˜¯ä¸€ä¸ª longï¼Œå› æ­¤ q, r ä¸­æœ‰ä¸€ä¸ª long
* %edi è½¬ float, å› æ­¤æœ‰ä¸€ä¸ª int, ä¸€ä¸ª long, 
* ä¸‹é¢ div è¯­å¥è¯´æ˜ p æ˜¯ intï¼Œq, r ä¸­æœ‰ä¸€ä¸ª float, ä¸€ä¸ª long
* ä¸‹é¢è½¬ double è¯´æ˜ s æ˜¯ double
* æ€»ç»“ä¸‹ï¼Œç¡®å®šçš„æ˜¯ p ä¸€å®šæ˜¯ int, s ä¸€å®šæ˜¯ doubleï¼Œè€Œ q, r ä¸ç¡®å®šï¼ŒåªçŸ¥é“ä¸€ä¸ªæ˜¯ float, ä¸€ä¸ªæ˜¯ longï¼Œå› æ­¤å¯ä»¥æ˜¯
* double funct1(int p, long q, float r, double s)
* double funct1(int p, float r, long q, double s)
* ä¸Šé¢ä¸¤ç§ğŸ‘†

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_54.png)

~~~C
x * y - w / z  
~~~

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_55.png)

* 1077936128 çš„ 16 è¿›åˆ¶æ˜¯ 0x40400000ï¼Œå³ `0100 0000 0100 0000 0000 0000 0000`ï¼Œå› æ­¤ç›¸å½“äº `0 10000000100 000...`ï¼Œå¯ä»¥çœ‹å‡ºï¼Œé˜¶ç ä¸º  1028 - 1023 = 5ï¼Œå³ 2^5 * 1 = 32

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_56.png)

* A. ç”¨ 0x7fffffffffffffff æ¥ä¸ï¼Œå³æ¸…ç©ºç¬¦å·ä½ï¼Œè½¬æˆæ­£æ•°
* B. ç½® 0
* C. ç”¨ 0x1000000000000000 æ¥æˆ–ï¼Œå³è®¾ç½®ç¬¦å·ä½ä¸º 1ï¼Œè½¬æˆè´Ÿæ•°

![](https://github.com/YangXiaoHei/OS/blob/master/CSAPP/ch3%20ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º/images/practise_03_57.png)

~~~C
double funct3(int *ap, double b, long c, float *dp)
{
	double val;
	double d = *ap;
	float f = *dp;
	if (b <= d) {
		f += f;
		f += c;
		val = f;
	} else {
		val = c * f
	}
	return val;
}
~~~



















